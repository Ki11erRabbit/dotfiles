#+TITLE: Emacs Configuration
#+AUTHOR: ki11errabbit
#+PROPERTY: header-args:emacs-lisp :tangle ~/.emacs.d/config.el
#+STARTUP: overview

* Table of Contents :TOC:
- [[#introduction][Introduction]]
- [[#early-init][Early Init]]
- [[#package-management][Package Management]]
- [[#basic-settings][Basic Settings]]
  - [[#font-configuration][Font Configuration]]
  - [[#ui-cleanup][UI Cleanup]]
  - [[#mouse-configuration][Mouse Configuration]]
- [[#programming-settings][Programming Settings]]
  - [[#line-numbers][Line Numbers]]
  - [[#indentation][Indentation]]
  - [[#c-mode-configuration][C Mode Configuration]]
- [[#load-evil-configuration][Load Evil Configuration]]
- [[#visual-enhancements][Visual Enhancements]]
  - [[#icons][Icons]]
  - [[#modeline][Modeline]]
  - [[#tabs][Tabs]]
  - [[#theme][Theme]]
  - [[#rainbow-delimiters][Rainbow Delimiters]]
  - [[#rainbow-mode][Rainbow Mode]]
  - [[#indent-guide][Indent Guide]]
- [[#file-management][File Management]]
  - [[#dired][Dired]]
  - [[#treemacs][Treemacs]]
- [[#editing-enhancements][Editing Enhancements]]
  - [[#company-completion][Company Completion]]
  - [[#drag-stuff][Drag Stuff]]
  - [[#browse-kill-ring][Browse Kill Ring]]
  - [[#sudo-edit][Sudo Edit]]
  - [[#delete-selection-mode][Delete Selection Mode]]
- [[#search-and-navigation][Search and Navigation]]
  - [[#deadgrep][Deadgrep]]
  - [[#projectile][Projectile]]
  - [[#vertico][Vertico]]
  - [[#which-key][Which Key]]
- [[#version-control][Version Control]]
  - [[#magit][Magit]]
  - [[#diff-hl][Diff-HL]]
- [[#development-tools][Development Tools]]
  - [[#eglot-language-server][Eglot (Language Server)]]
  - [[#dap-mode-debugger][DAP Mode (Debugger)]]
  - [[#flymake][Flymake]]
  - [[#eldoc][Eldoc]]
- [[#language-specific][Language Specific]]
  - [[#latex][LaTeX]]
  - [[#programming-languages][Programming Languages]]
- [[#terminal-emulation][Terminal Emulation]]
  - [[#vterm][VTerm]]
  - [[#eshell][Eshell]]
- [[#text-editing][Text Editing]]
  - [[#org-mode][Org Mode]]
  - [[#flyspell][Flyspell]]
  - [[#context-menu][Context Menu]]
- [[#window-management][Window Management]]
  - [[#golden-ratio][Golden Ratio]]
- [[#native-compilation][Native Compilation]]
- [[#custom-variables][Custom Variables]]

* Introduction

This is my literate Emacs configuration using org-mode. It uses a custom keyboard layout
(m=left, n=down, e=up, i=right) and is optimized for programming with Evil mode.

The configuration uses Eglot instead of lsp-mode for better performance and simplicity.

**Evil Configuration:** All Evil mode related settings, keybindings, and packages are in
a separate =evil.org= file which is tangled and loaded automatically.

* Early Init

First, we set up the PATH for macOS systems to ensure all binaries are accessible.

#+begin_src emacs-lisp
(cond
 ((string-equal system-type "darwin")
  (setenv "PATH" "/Users/ki11errabbit/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Applications/Ghostty.app/Contents/MacOS")
  (setq exec-path (split-string (getenv "PATH") path-separator))))
#+end_src

* Package Management

Package management is handled by the bootstrap init.el file.
We just need to require use-package here since it's already installed.

#+begin_src emacs-lisp
;; use-package is already set up by init.el
;; This section is kept for documentation purposes
#+end_src

* Basic Settings

** Font Configuration

Set the default font to JetBrainsMono Nerd Font for better icon support.

#+begin_src emacs-lisp
(add-to-list 'default-frame-alist '(font . "JetBrainsMono Nerd Font"))
(set-face-attribute 'default nil :font "JetBrainsMono Nerd Font" :height 120)
#+end_src

** UI Cleanup

Remove unnecessary UI elements for a cleaner interface.

#+begin_src emacs-lisp
(tool-bar-mode -1)
(menu-bar-mode -1)
(if (boundp 'fringe-mode)
    (fringe-mode -1))
(if (boundp 'scroll-bar-mode)
    (scroll-bar-mode -1))
#+end_src

** Mouse Configuration

Enable mouse support in terminal and configure focus behavior.

#+begin_src emacs-lisp
(xterm-mouse-mode)
(setq mouse-wheel-progressive-speed nil)
(setq focus-follows-mouse "auto-raise")
(setq mouse-autoselect-window 't)
#+end_src

* Programming Settings

** Line Numbers

Display line numbers in programming modes.

#+begin_src emacs-lisp
(add-hook 'prog-mode-hook 'display-line-numbers-mode)
#+end_src

** Indentation

Set default indentation to spaces instead of tabs.

#+begin_src emacs-lisp
(setq-default indent-tabs-mode nil)
#+end_src

** C Mode Configuration

Custom indentation settings for C and C++ modes.

#+begin_src emacs-lisp
(defun my-c-mode-common-hook ()
  "My customizations for all of c-mode, c++-mode, objc-mode, java-mode"
  (c-set-offset 'substatement-open 0)
  (setq c++-tab-always-indent t)
  (setq c-basic-offset 4)
  (setq c-indent-level 4)
  (setq tab-stop-list '(4 8 12 16 20 24 28 32 36 40 44 48 52 56 60))
  (setq tab-width 4)
  (setq indent-tabs-mode nil))

(add-hook 'c-mode-common-hook 'my-c-mode-common-hook)
#+end_src

* Load Evil Configuration

All Evil mode configuration is in =evil.org=. This section tangles and loads it.

#+begin_src emacs-lisp
(let* ((evil-org (expand-file-name "evil.org" user-emacs-directory))
       (evil-el (expand-file-name "evil.el" user-emacs-directory)))
  
  ;; Tangle evil.org if needed
  (when (or (not (file-exists-p evil-el))
            (file-newer-than-file-p evil-org evil-el))
    (message "Tangling evil.org...")
    (org-babel-tangle-file evil-org evil-el))
  
  ;; Load the tangled evil configuration
  (message "Loading Evil configuration...")
  (load-file evil-el))
#+end_src

* Visual Enhancements

** Icons

Enable beautiful icons throughout Emacs.

#+begin_src emacs-lisp
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p))

(use-package all-the-icons-nerd-fonts
  :after all-the-icons)

(use-package nerd-icons)
#+end_src

** Modeline

Use Doom modeline for a modern, informative status bar.

#+begin_src emacs-lisp
(use-package doom-modeline
  :ensure t
  :init (doom-modeline-mode 1)
  :config (column-number-mode 1)
  :custom
  (doom-modeline-height 30)
  (doom-modeline-window-width-limit nil)
  (doom-modeline-buffer-file-name-style 'truncate-with-project)
  (doom-modeline-enable-word-count t)
  (doom-modeline-buffer-modification-icon t)
  (doom-modeline-time t)
  (doom-modeline-vcs-max-length 50))
#+end_src

** Tabs

Enable buffer tabs for easy navigation between files.

#+begin_src emacs-lisp
(use-package centaur-tabs
  :demand
  :config
  (centaur-tabs-mode t)
  (setq centaur-tabs-set-icons t)
  :bind
  ("C-<prior>" . centaur-tabs-backward)
  ("C-<next>" . centaur-tabs-forward))
#+end_src

** Theme

Use Catppuccin Latte theme for a pleasant light color scheme.

#+begin_src emacs-lisp
(use-package catppuccin-theme)

(setq catppuccin-flavor 'latte)
(add-hook 'after-init-hook (lambda () (load-theme 'catppuccin t)))
#+end_src

** Rainbow Delimiters

Color-code matching parentheses for easier reading.

#+begin_src emacs-lisp
(use-package rainbow-delimiters
  :hook (prog-mode . rainbow-delimiters-mode))
#+end_src

** Rainbow Mode

Display color codes in their actual colors.

#+begin_src emacs-lisp
(use-package rainbow-mode
  :hook (prog-mode . rainbow-mode))
#+end_src

** Indent Guide

Show vertical lines to visualize indentation levels.

#+begin_src emacs-lisp
(use-package indent-guide
  :ensure t
  :hook (prog-mode . indent-guide-mode))
#+end_src

* File Management

** Dired

Enhanced directory editor with icons and rsync support.

#+begin_src emacs-lisp
(use-package dired-rsync
  :bind (:map dired-mode-map
              ("C-x d" . dired-rsync)))

(use-package all-the-icons-dired
  :hook (dired-mode . all-the-icons-dired-mode))
#+end_src

** Treemacs

Project tree explorer.

#+begin_src emacs-lisp
(use-package treemacs
  :ensure t
  :bind ("<f5>" . treemacs)
  :custom
  (treemacs-is-never-other-window t)
  :hook
  (treemacs-mode . treemacs-project-follow-mode))
#+end_src

* Editing Enhancements

** Company Completion

Autocompletion framework with a nice UI.

#+begin_src emacs-lisp
(use-package company
  :ensure t
  :hook (after-init . global-company-mode)
  :after eglot
  :config
  ;; Eglot integrates with company via completion-at-point
  (setq company-backends
        (cons 'company-capf
              (remove 'company-capf company-backends))))

(use-package company-box
  :hook (company-mode . company-box-mode))
#+end_src

** Drag Stuff

Move lines and regions up and down easily.

#+begin_src emacs-lisp
(use-package drag-stuff
  :config
  (drag-stuff-global-mode 1)
  (drag-stuff-define-keys))
#+end_src

** Browse Kill Ring

Browse and insert from kill ring history.

#+begin_src emacs-lisp
(use-package browse-kill-ring)
#+end_src

** Sudo Edit

Edit files with sudo privileges.

#+begin_src emacs-lisp
(use-package sudo-edit
  :config
  (bind-keys :map evil-normal-state-map
             :prefix "SPC"
             :prefix-map sudo-edit-map
             ("s e" . sudo-edit)))
#+end_src

** Delete Selection Mode

Replace selection when typing.

#+begin_src emacs-lisp
(delete-selection-mode 1)
#+end_src

* Search and Navigation

** Deadgrep

Fast search using ripgrep.

#+begin_src emacs-lisp
(use-package deadgrep
  :ensure t
  :bind ("<f4>" . deadgrep))
#+end_src

** Projectile

Project management and navigation.

#+begin_src emacs-lisp
(use-package projectile
  :ensure t
  :config
  (projectile-mode +1)
  (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map))
#+end_src

** Vertico

Vertical completion UI with posframe.

#+begin_src emacs-lisp
(use-package vertico-posframe
  :ensure t
  :custom
  (vertico-posframe-parameters
   '((left-fringe . 8)
     (right-fringe . 8))))

(vertico-posframe-mode)
#+end_src

** Which Key

Display available keybindings in popup.

#+begin_src emacs-lisp
(use-package which-key
  :config
  (which-key-mode))
#+end_src

* Version Control

** Magit

The best Git interface.

#+begin_src emacs-lisp
(use-package magit)
#+end_src

** Diff-HL

Highlight uncommitted changes in the fringe.

#+begin_src emacs-lisp
(use-package diff-hl
  :config
  (global-diff-hl-mode))
#+end_src

* Development Tools

** Eglot (Language Server)

Built-in Language Server Protocol client for IDE features.

#+begin_src emacs-lisp
(use-package eglot
  :ensure t
  :hook ((python-mode . eglot-ensure)
         (haskell-mode . eglot-ensure)
         (haskell-literate-mode . eglot-ensure)
         (c-mode . eglot-ensure)
         (c++-mode . eglot-ensure)
         (rust-mode . eglot-ensure)
         (racket-mode . eglot-ensure)
         (zig-mode . eglot-ensure)
         (nix-mode . eglot-ensure)
         (go-mode . eglot-ensure)
         (idris-mode . eglot-ensure)
         (lua-mode . eglot-ensure)
         (koka-mode . eglot-ensure))
  :bind (:map eglot-mode-map
              ("C-c l r" . eglot-rename)
              ("C-c l a" . eglot-code-actions)
              ("C-c l f" . eglot-format)
              ("C-c l h" . eldoc-doc-buffer)
              ("C-c l d" . xref-find-definitions)
              ("C-c l R" . xref-find-references)
              ("C-c l n" . flymake-goto-next-error)
              ("C-c l e" . flymake-goto-prev-error))
  :custom
  ;; Performance optimizations
  (eglot-events-buffer-size 0)
  (eglot-sync-connect nil)
  (eglot-autoshutdown t)
  (eglot-send-changes-idle-time 0.5)
  :config
  ;; Enable which-key integration
  (add-hook 'eglot-managed-mode-hook
            (lambda ()
              (when (fboundp 'which-key-mode)
                (which-key-add-key-based-replacements
                  "C-c l" "eglot")))))
#+end_src

** DAP Mode (Debugger)

Debug Adapter Protocol for debugging support.

#+begin_src emacs-lisp
(use-package dap-mode
  :ensure t
  :config
  (setq dap-auto-configure-features '(sessions locals controls tooltip))
  (require 'dap-python)
  (setq dap-python-debugger 'debugpy)
  (require 'dap-gdb)
  (setq dap-gdb-debug-program '("rust-gdb" "-i" "dap"))
  (require 'dap-dlv-go))
#+end_src

** Flymake

On-the-fly syntax checking (used by Eglot).

#+begin_src emacs-lisp
(use-package flymake
  :ensure t
  :custom
  (flymake-no-changes-timeout 0.5)
  :config
  (setq flymake-fringe-indicator-position 'left-fringe))
#+end_src

** Eldoc

Display documentation in the echo area.

#+begin_src emacs-lisp
(use-package eldoc
  :ensure t
  :custom
  (eldoc-echo-area-use-multiline-p nil)
  (eldoc-idle-delay 0.1))
#+end_src

* Language Specific

** LaTeX

AUCTeX for LaTeX editing with preview support.

#+begin_src emacs-lisp
(use-package auctex
  :ensure t
  :defer t
  :config
  (setq TeX-auto-save t)
  (setq TeX-parse-self t)
  (setq-default TeX-master nil)
  (setq TeX-PDF-mode t)
  (bind-keys :map evil-normal-state-map
             :prefix "SPC"
             :prefix-map preview-map
             ("l p" . preview-buffer)))

(use-package company-auctex
  :ensure t
  :after company
  :after auctex
  :hook (LaTeX-mode . company-auctex-init))

(use-package cdlatex
  :ensure t
  :hook (LaTeX-mode . turn-on-cdlatex))
#+end_src

** Programming Languages

Load major modes for various programming languages.

#+begin_src emacs-lisp
(use-package python-mode)
(use-package haskell-mode)
(use-package rust-mode)
(use-package racket-mode)
(use-package zig-mode)
(use-package nix-mode :mode "\\.nix\\'")
(use-package go-mode)
(use-package idris-mode)
(use-package lua-mode)
(use-package proof-general)
#+end_src

* Terminal Emulation

** VTerm

Fast, fully-featured terminal emulator.

#+begin_src emacs-lisp
(use-package vterm
  :ensure t
  :custom
  (vterm-max-scrollback 100000))
#+end_src

** Eshell

Emacs shell with auto-suggestions.

#+begin_src emacs-lisp
(use-package esh-autosuggest
  :ensure t
  :after esh
  :config
  (eshell-mode . esh-autosuggest-mode))
#+end_src

* Text Editing

** Org Mode

Already loaded, just configure Evil bindings.

#+begin_src emacs-lisp
(use-package org)
#+end_src

** Flyspell

Spell checking for text and programming modes.

#+begin_src emacs-lisp
(use-package flyspell
  :custom
  (setq ispell-program-name "hunspell")
  (hunspell-dictionary "en_US")
  :config
  (add-hook 'text-mode-hook 'flyspell-mode)
  (add-hook 'prog-mode-hook 'flyspell-prog-mode)
  (add-hook 'org-mode-hook 'flyspell-mode)
  (add-hook 'LaTeX-mode-hook 'flyspell-mode)
  (add-hook 'markdown-mode-hook 'flyspell-mode))
#+end_src

** Context Menu

Enable context menus in various modes.

#+begin_src emacs-lisp
(add-hook 'text-mode-hook 'context-menu-mode)
(add-hook 'prog-mode-hook 'context-menu-mode)
(add-hook 'org-mode-hook 'context-menu-mode)
(add-hook 'dired-mode-hook 'context-menu-mode)
(add-hook 'LaTeX-mode-hook 'context-menu-mode)
#+end_src

* Window Management

** Golden Ratio

Automatically resize windows to golden ratio.

#+begin_src emacs-lisp
(use-package golden-ratio
  :ensure t
  :hook (after-init . golden-ratio-mode)
  :custom
  (golden-ratio-exclude-modes '(occur-mode)))
#+end_src

* Native Compilation

Configure native compilation settings.

#+begin_src emacs-lisp
(setq native-comp-async-report-warnings-errors 'silent)
(setq native-comp-deferred-compilation t)
#+end_src

* Custom Variables

Emacs custom variables (auto-generated).

#+begin_src emacs-lisp
(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(package-selected-packages nil)
 '(warning-suppress-types
   '(((copilot copilot-no-mode-indent))
     ((copilot copilot-no-mode-indent))
     ((copilot copilot-no-mode-indent)))))

(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
#+end_src
